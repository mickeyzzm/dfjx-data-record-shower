webpackJsonp([10],{"307n":function(t,e){},hkO7:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("fZjL"),i=a.n(n),r=a("j1XB"),l={name:"GriddimRecordRow",describe:"表格内的数据行",components:{WorkMain:r.a},props:{dataArrayName:{type:String},reportDataLine:{type:Object},rowLineNumber:{type:Number},arrayIndex:{type:Number},unitFlds:{type:Array},fldDicts:{type:Object},removeLine:{type:Function},needRecordDel:{type:Boolean},validateResultObj:{type:Object}},data:function(){return{}},methods:{refreshData:function(){var t=this.reportDataLine;this.reportDataLine=null,this.reportDataLine=t}},mounted:function(){},activated:function(){}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("tr",{staticClass:"el-table__row mini-font-size "},[a("td",{staticClass:"  is-center table-row",class:{"table-row-color":t.rowLineNumber%2==0},staticStyle:{width:"60px"},attrs:{colspan:"1",rowspan:"1"}},[t._v("\n    "+t._s(t.rowLineNumber+1)+"\n  ")]),t._v(" "),t._l(t.unitFlds,function(e){return a("td",{staticClass:"is-center table-row ",class:{"table-row-color":t.rowLineNumber%2==0},attrs:{colspan:"1",rowspan:"1"}},[a("div",{staticClass:"cell"},[a("div",{staticClass:"el-form-item",staticStyle:{margin:"auto"}},[a("div",{staticClass:"el-form-item__content"},[0==e.fld_data_type||1==e.fld_data_type?a("div",{staticClass:"el-input el-input--mini ",class:{"el-input-group el-input-group--append":null!=e.fld_point&&""!=e.fld_point}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.reportDataLine["f"+e.fld_id],expression:"reportDataLine['f'+unitFld.fld_id]"}],staticClass:"el-input__inner",attrs:{placeholder:"请输入"},domProps:{value:t.reportDataLine["f"+e.fld_id]},on:{input:function(a){a.target.composing||t.$set(t.reportDataLine,"f"+e.fld_id,a.target.value)}}}),t._v(" "),null!=e.fld_point&&""!=e.fld_point?a("div",{staticClass:"el-input-group__append"},[t._v(t._s(e.fld_point))]):t._e()]):t._e(),t._v(" "),2==e.fld_data_type?a("el-date-picker",{attrs:{size:"mini",align:"left",type:"date",placeholder:"选择日期"},model:{value:t.reportDataLine["f"+e.fld_id],callback:function(a){t.$set(t.reportDataLine,"f"+e.fld_id,a)},expression:"reportDataLine['f'+unitFld.fld_id]"}}):t._e(),t._v(" "),3==e.fld_data_type?a("el-select",{on:{change:t.refreshData},model:{value:t.reportDataLine["f"+e.fld_id],callback:function(a){t.$set(t.reportDataLine,"f"+e.fld_id,a)},expression:"reportDataLine['f'+unitFld.fld_id]"}},t._l(t.fldDicts["f"+e.fld_id],function(t){return a("el-option",{key:t.dict_content_value,attrs:{label:t.dict_content_name,value:t.dict_content_value}})})):t._e(),t._v(" "),null!=t.validateResultObj[t.reportDataLine.colum_id]&&null!=t.validateResultObj[t.reportDataLine.colum_id][e.fld_id]?a("div",{staticStyle:{padding:"0",margin:"0","font-size":"8px",color:"red"}},[t._v(t._s(t.validateResultObj[t.reportDataLine.colum_id][e.fld_id]))]):t._e()],1)])])])}),t._v(" "),a("td",{staticClass:"  is-center  table-row ",class:{"table-row-color":t.rowLineNumber%2==0},attrs:{colspan:"1",rowspan:"1"}},[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(e){t.removeLine(t.arrayIndex,t.dataArrayName,t.needRecordDel)}}},[t._v("删除")])],1)],2)},staticRenderFns:[]},o=a("VU/8")(l,s,!1,null,null,null).exports,d={name:"GriddimRecord",describe:"多维静态报表填报单元",components:{WorkMain:r.a,GriddimRecordRow:o},props:{jobId:{type:String},reportId:{type:String},unitId:{type:Number},unitType:{type:Number},isView:{type:String}},data:function(){return{lastStep:!1,definedIndexs:[],unitFldTypes:[],unitFlds:[],fldDicts:{},dbDataLineArray:[],newReportDataLine:[],delReportDataLine:[],validateResultObj:{},newDataValidateResultObj:{},hasMounted:!1,cacheOptions:""}},methods:{getUnitFldsConfig:function(){var t=this,e=null;"N"==this.saveFlag&&(e=this.$loading({lock:!0,text:"获取填报单元信息中.......",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"})),this.BaseRequest({url:"/record/process/getClientFldByUnitId",params:{groupId:this.unitId,clientType:"PC"}}).then(function(a){if(e&&e.close(),null!=a){var n=[];t.unitFldTypes=a,a.forEach(function(t){t.unitFlds.forEach(function(t){n.push(t)})}),t.unitFlds=n}}).catch(function(a){t.Message.success(a),e.close()})},getUnitDictFldContent:function(){var t=this;this.BaseRequest({url:"/record/process/getUnitDictFldContent",params:{groupId:this.unitId}}).then(function(e){if(e){var a=i()(e);for(var n in a){var r=e[a[n]];t.fldDicts["f"+a[n]]=r}}}).catch(function(e){t.Message.success(e)})},getReportFldDatas:function(){var t=this;this.BaseRequest({url:"/record/process/getFldReportDatas",params:{jobId:this.jobId,reportId:this.reportId,groupId:this.unitId}}).then(function(e){new Object;var a=[];e&&(e.forEach(function(t){var e=t.colum_id,n=t.fld_id;a[e]||(a[e]=new Object,a[e].colum_id=e),a[e]["f"+n]=t.record_data}),t.dbDataLineArray=a)}).catch(function(e){t.Message.success(e)})},addOne:function(){var t=this.newReportDataLine.length,e=this.newReportDataLine,a=new Object;this.unitFlds.forEach(function(t){a["f"+t.fld_id]=""}),e[t]=a,this.newReportDataLine=null,this.newReportDataLine=e},removeLine:function(t,e,a){var n=this,i=new Array;this[e].forEach(function(e,r){r!=t?i.push(e):a&&n.delReportDataLine.push(e)}),this[e]=i},getParseRecordData:function(t){var e=this,a=new Array;return t&&t.forEach(function(t,n){e.unitFlds.forEach(function(i){var r=t["f"+i.fld_id];a.push({report_id:e.reportId,unit_id:e.unitId,colum_id:t.colum_id?t.colum_id:n,fld_id:i.fld_id,record_data:r})})}),a},reloadData:function(t){console.log(t);var e=this[t];this[t]=null,this[t]=e},doSaveUnitContext:function(t){var e=this,a=this.getParseRecordData(this.dbDataLineArray),n=this.getParseRecordData(this.newReportDataLine),i=this.getParseRecordData(this.delReportDataLine),r={report_id:this.reportId,job_id:this.jobId,reportJobInfos:a,newReportJobInfos:n,delReportJobInfos:i};this.BaseRequest({url:"/record/process/saveGridDatas",method:"post",data:r}).then(function(a){a?e.$emit("saveReportsCallBack",e.unitId,t):e.$emit("saveReportsCallBack",e.unitId,t,"保存失败")}).catch(function(a){e.$emit("saveReportsCallBack",e.unitId,t,a)})},doValidateUnitContext:function(t){var e=this;this.validateResultObj={},this.newDataValidateResultObj={};var a=this.getParseRecordData(this.dbDataLineArray),n=this.getParseRecordData(this.newReportDataLine),r=this.$loading({lock:!0,text:"数据校验中.......",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});this.BaseRequest({url:"/record/process/validateGridDatas",method:"post",data:{reportJobInfos:a,newReportJobInfos:n}}).then(function(a){r.close(),a||e.$emit("validateReportsCallBack",e.unitId,t,"校验出现异常");var n=!1,l=a.reportJobDataValidate,s=a.newReportJobDataValidate;l&&i()(l).length>0&&(e.validateResultObj=l,n=!0),s&&i()(s).length>0&&(e.newDataValidateResultObj=s,n=!0);var o=null;n&&(o="有输入错误"),e.$emit("validateReportsCallBack",e.unitId,t,o)})},setSaveFlag:function(t){this.saveFlag=t}},mounted:function(){this.getUnitFldsConfig(),this.getUnitDictFldContent(),this.getReportFldDatas()},activated:function(){}},c={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{width:"100%"}},[a("el-row",{staticStyle:{"text-align":"left",margin:"0 0 5px 0"}},[a("el-col",{attrs:{span:24}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.addOne}},[t._v("增加一条记录")])],1)],1),t._v(" "),a("div",{staticClass:"el-table el-table--fit el-table--striped el-table--border el-table--enable-row-hover el-table--enable-row-transition el-table--small",staticStyle:{border:"0","background-color":"transparent"}},[a("div",{staticClass:"el-table__header-wrapper el-table__body-wrapper ",staticStyle:{"overflow-x":"auto !important","overflow-y":"auto"}},[a("table",{staticClass:"el-table__header",attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[a("thead",{staticClass:"has-gutter"},[a("tr",{staticStyle:{"font-size":"14px"}},[a("th",{staticClass:"el-table_6_column_31  is-center   is-leaf ",attrs:{colspan:"1",rowspan:"2"}},[t._v("\n                     序号      \n              ")]),t._v(" "),t._l(t.unitFldTypes,function(e){return a("th",{staticClass:"el-table_6_column_31  is-center   is-leaf ",attrs:{colspan:e.unitFlds.length,rowspan:"1"}},[a("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(e.catg_name))])])}),t._v(" "),a("th",{staticClass:"el-table_6_column_31  is-center is-leaf",attrs:{colspan:"1",rowspan:"2"}},[t._v("\n                     操作     \n              ")])],2),t._v(" "),a("tr",{staticStyle:{"font-size":"14px"}},t._l(t.unitFlds,function(e){return a("th",{staticClass:"el-table_6_column_31  is-center is-leaf",staticStyle:{"min-width":"225px"},attrs:{colspan:"1",rowspan:"1"}},[t._v("\n                "+t._s(e.fld_name)+"\n              ")])}))]),t._v(" "),a("tbody",[t._l(t.dbDataLineArray,function(e,n){return a("GriddimRecordRow",{key:"dbDataLineArray"+n,attrs:{reportDataLine:e,rowLineNumber:n,dataArrayName:"dbDataLineArray",arrayIndex:n,removeLine:t.removeLine,reloadData:t.reloadData,needRecordDel:!0,unitFlds:t.unitFlds,fldDicts:t.fldDicts,validateResultObj:t.validateResultObj}})}),t._v(" "),t._l(t.newReportDataLine,function(e,n){return a("GriddimRecordRow",{key:"newReportDataLine"+n,attrs:{reportDataLine:e,rowLineNumber:n,dataArrayName:"newReportDataLine",arrayIndex:n,removeLine:t.removeLine,reloadData:t.reloadData,needRecordDel:!1,unitFlds:t.unitFlds,fldDicts:t.fldDicts,validateResultObj:t.newDataValidateResultObj}})})],2)])])])],1)},staticRenderFns:[]};var u=a("VU/8")(d,c,!1,function(t){a("307n")},"data-v-7e76c9c8",null);e.default=u.exports}});
//# sourceMappingURL=10.f928e898203d580134a4.js.map